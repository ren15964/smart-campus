import{g as Z,d as ee,u as le,p as te}from"./homework-RLnz-2_s.js";import{a as oe}from"./course-CglI6mUT.js";import{_ as ae,s as re,c as I,a as l,w as a,E as p,r as s,h as v,g as x,d as ne,S as se,o as y,f as m,U as de,I as F,b as h,G as ie,H as ue,z as M,Q as me}from"./index-jCaZfwQD.js";import{A as ce}from"./AppEmpty-BAEE0X2a.js";const pe={class:"homework-manage-container"},fe={class:"card-header"},ge={class:"pagination-container"},_e={class:"dialog-footer"},ve={__name:"HomeworkManage",setup(be){const B=ne(),z=v([]),V=v(!1),c=x({keyword:"",semester:""}),d=x({current:1,size:10,total:0}),g=v(!1),i=v(!1),b=v(null),C=v([]),r=x({id:null,scheduleId:null,title:"",content:"",deadline:"",totalScore:100,attachment:""}),D={scheduleId:[{required:!0,message:"请选择课程",trigger:"change"}],title:[{required:!0,message:"请输入作业标题",trigger:"blur"}],content:[{required:!0,message:"请输入作业内容",trigger:"blur"}],deadline:[{required:!0,message:"请选择截止日期",trigger:"change"}],totalScore:[{required:!0,message:"请输入总分",trigger:"change"}]},f=async()=>{V.value=!0;try{const t=await Z({current:d.current,size:d.size,...c});t.code===200&&(z.value=t.data.records||t.data,d.total=t.data.total||t.data.length)}catch(t){console.error("获取作业列表失败:",t),p.error("获取作业列表失败，请稍后再试")}finally{V.value=!1}},E=async()=>{if(!(C.value.length>0))try{const t=await oe({current:1,size:1e3});t.code===200&&(C.value=t.data.records)}catch(t){console.error("获取教师课程选项失败:",t)}},R=()=>{d.current=1,f()},S=()=>{c.keyword="",c.semester="",d.current=1,f()},T=t=>{d.size=t,f()},q=t=>{d.current=t,f()},N=()=>{i.value=!1,g.value=!0,M(()=>{var t;(t=b.value)==null||t.resetFields(),Object.assign(r,{id:null,scheduleId:null,title:"",content:"",deadline:"",totalScore:100,attachment:""})})},O=t=>{i.value=!0,g.value=!0,M(()=>{Object.assign(r,t)})},j=async t=>{me.confirm(`确定要删除作业《${t.title}》吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const e=await ee(t.id);e.code===200?(p.success("删除成功"),f()):p.error(e.message||"删除失败")}catch(e){console.error("删除失败:",e),p.error("删除失败，请稍后再试")}}).catch(()=>{p.info("已取消删除")})},L=()=>{var t;(t=b.value)==null||t.validate(async e=>{if(e)try{let n;i.value?n=await le(r.id,r):n=await te(r),n.code===200?(p.success(`${i.value?"编辑":"发布"}成功`),g.value=!1,f()):p.error(n.message||`${i.value?"编辑":"发布"}失败`)}catch(n){console.error(`${i.value?"编辑":"发布"}失败:`,n),p.error(`${i.value?"编辑":"发布"}失败，请稍后再试`)}})},Y=()=>{var t;(t=b.value)==null||t.resetFields(),Object.assign(r,{id:null,scheduleId:null,title:"",content:"",deadline:"",totalScore:100,attachment:""})},A=t=>{B.push({name:"HomeworkGrade",params:{id:t.id}})};return re(()=>{f()}),(t,e)=>{const n=s("el-button"),w=s("el-input"),u=s("el-form-item"),k=s("el-option"),H=s("el-select"),U=s("el-form"),_=s("el-table-column"),G=s("el-table"),P=s("el-pagination"),Q=s("el-card"),J=s("el-date-picker"),K=s("el-input-number"),W=s("el-dialog"),X=se("loading");return y(),I("div",pe,[l(Q,{class:"box-card"},{header:a(()=>[h("div",fe,[e[13]||(e[13]=h("span",null,"作业管理",-1)),l(n,{type:"primary",onClick:N},{default:a(()=>[...e[12]||(e[12]=[m("发布作业",-1)])]),_:1})])]),default:a(()=>[l(U,{inline:!0,model:c,class:"search-form"},{default:a(()=>[l(u,{label:"课程名称"},{default:a(()=>[l(w,{modelValue:c.keyword,"onUpdate:modelValue":e[0]||(e[0]=o=>c.keyword=o),placeholder:"请输入课程名称或作业标题",clearable:""},null,8,["modelValue"])]),_:1}),l(u,{label:"学期"},{default:a(()=>[l(H,{modelValue:c.semester,"onUpdate:modelValue":e[1]||(e[1]=o=>c.semester=o),placeholder:"请选择学期",clearable:""},{default:a(()=>[l(k,{label:"2023-2024-1",value:"2023-2024-1"}),l(k,{label:"2023-2024-2",value:"2023-2024-2"}),l(k,{label:"2024-2025-1",value:"2024-2025-1"})]),_:1},8,["modelValue"])]),_:1}),l(u,null,{default:a(()=>[l(n,{type:"primary",onClick:R},{default:a(()=>[...e[14]||(e[14]=[m("查询",-1)])]),_:1}),l(n,{onClick:S},{default:a(()=>[...e[15]||(e[15]=[m("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),de((y(),F(G,{data:z.value,border:"",style:{width:"100%"}},{empty:a(()=>[l(ce,{description:"暂无作业"},{default:a(()=>[l(n,{type:"primary",onClick:S},{default:a(()=>[...e[16]||(e[16]=[m("清空筛选",-1)])]),_:1})]),_:1})]),default:a(()=>[l(_,{prop:"id",label:"ID",width:"80"}),l(_,{prop:"courseName",label:"课程名称",width:"150"}),l(_,{prop:"title",label:"作业标题","show-overflow-tooltip":""}),l(_,{prop:"deadline",label:"截止日期",width:"180"}),l(_,{prop:"totalScore",label:"总分",width:"80"}),l(_,{label:"操作",width:"200"},{default:a(o=>[l(n,{type:"primary",link:"",onClick:$=>A(o.row)},{default:a(()=>[...e[17]||(e[17]=[m(" 查看提交 ",-1)])]),_:1},8,["onClick"]),l(n,{type:"warning",link:"",onClick:$=>O(o.row)},{default:a(()=>[...e[18]||(e[18]=[m(" 编辑 ",-1)])]),_:1},8,["onClick"]),l(n,{type:"danger",link:"",onClick:$=>j(o.row)},{default:a(()=>[...e[19]||(e[19]=[m(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[X,V.value]]),h("div",ge,[l(P,{"current-page":d.current,"onUpdate:currentPage":e[2]||(e[2]=o=>d.current=o),"page-size":d.size,"onUpdate:pageSize":e[3]||(e[3]=o=>d.size=o),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:d.total,onSizeChange:T,onCurrentChange:q},null,8,["current-page","page-size","total"])])]),_:1}),l(W,{modelValue:g.value,"onUpdate:modelValue":e[11]||(e[11]=o=>g.value=o),title:i.value?"编辑作业":"发布作业",width:"700px",onClose:Y},{footer:a(()=>[h("span",_e,[l(n,{onClick:e[10]||(e[10]=o=>g.value=!1)},{default:a(()=>[...e[20]||(e[20]=[m("取消",-1)])]),_:1}),l(n,{type:"primary",onClick:L},{default:a(()=>[...e[21]||(e[21]=[m("确定",-1)])]),_:1})])]),default:a(()=>[l(U,{model:r,rules:D,ref_key:"homeworkFormRef",ref:b,"label-width":"100px"},{default:a(()=>[l(u,{label:"课程选择",prop:"scheduleId"},{default:a(()=>[l(H,{modelValue:r.scheduleId,"onUpdate:modelValue":e[4]||(e[4]=o=>r.scheduleId=o),placeholder:"请选择课程",filterable:"",disabled:i.value,onFocus:E},{default:a(()=>[(y(!0),I(ie,null,ue(C.value,o=>(y(),F(k,{key:o.id,label:`${o.courseName} (${o.semester})`,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),l(u,{label:"作业标题",prop:"title"},{default:a(()=>[l(w,{modelValue:r.title,"onUpdate:modelValue":e[5]||(e[5]=o=>r.title=o)},null,8,["modelValue"])]),_:1}),l(u,{label:"作业内容",prop:"content"},{default:a(()=>[l(w,{modelValue:r.content,"onUpdate:modelValue":e[6]||(e[6]=o=>r.content=o),type:"textarea",rows:"5"},null,8,["modelValue"])]),_:1}),l(u,{label:"截止日期",prop:"deadline"},{default:a(()=>[l(J,{modelValue:r.deadline,"onUpdate:modelValue":e[7]||(e[7]=o=>r.deadline=o),type:"datetime",placeholder:"选择日期时间","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),l(u,{label:"总分",prop:"totalScore"},{default:a(()=>[l(K,{modelValue:r.totalScore,"onUpdate:modelValue":e[8]||(e[8]=o=>r.totalScore=o),min:0,max:100},null,8,["modelValue"])]),_:1}),l(u,{label:"附件",prop:"attachment"},{default:a(()=>[l(w,{modelValue:r.attachment,"onUpdate:modelValue":e[9]||(e[9]=o=>r.attachment=o),placeholder:"请输入附件URL（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Ve=ae(ve,[["__scopeId","data-v-06f25d40"]]);export{Ve as default};
