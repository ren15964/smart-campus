import{_ as Z,s as ee,c as le,a as l,w as a,K as ae,r as s,h as V,g as U,S as te,o as k,I as h,j as D,b as x,f as i,U as oe,t as E,J as re,V as se,W as ne,X as ue,E as y,z as S,Q as de,Y as ie}from"./index-jCaZfwQD.js";import{A as pe}from"./AppEmpty-BAEE0X2a.js";const me={class:"user-manage"},ce={class:"card-header"},ge={class:"dialog-footer"},fe={__name:"UserManage",setup(_e){const C=V(!1),z=V([]),_=V(!1),n=V(!1),w=V(null),r=U({id:null,username:"",password:"",realName:"",role:"",email:"",phone:"",status:1}),q={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],realName:[{required:!0,message:"请输入姓名",trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"change"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:["blur","change"]}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号格式",trigger:["blur","change"]}]},p=U({role:"",keyword:""}),u=U({current:1,size:10,total:0}),f=async()=>{C.value=!0;try{const o={current:u.current,size:u.size,role:p.role,keyword:p.keyword},e=await ae(o);z.value=e.data.records,u.total=e.data.total}catch(o){console.error("获取用户列表失败:",o)}finally{C.value=!1}},F=()=>{u.current=1,f()},N=()=>{p.role="",p.keyword="",u.current=1,f()},R=()=>{f()},T=()=>{f()},j=()=>{n.value=!1,_.value=!0,S(()=>{var o;(o=w.value)==null||o.resetFields(),Object.assign(r,{id:null,username:"",password:"",realName:"",role:"",email:"",phone:"",status:1})})},A=o=>{n.value=!0,_.value=!0,S(()=>{Object.assign(r,o)})},I=()=>{var o;(o=w.value)==null||o.validate(async e=>{if(e)try{let c;n.value?c=await ne(r.id,r):c=await ue(r),c.code===200?(y.success(`${n.value?"编辑":"添加"}成功`),_.value=!1,f()):y.error(c.message||`${n.value?"编辑":"添加"}失败`)}catch(c){console.error(`${n.value?"编辑":"添加"}失败:`,c),y.error(`${n.value?"编辑":"添加"}失败，请稍后再试`)}})},O=()=>{var o;(o=w.value)==null||o.resetFields(),Object.assign(r,{id:null,username:"",password:"",realName:"",role:"",email:"",phone:"",status:1})},L=o=>{de.confirm(`确定要删除用户 ${o.realName} 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const e=await ie(o.id);e.code===200?(y.success("删除成功"),f()):y.error(e.message||"删除失败")}catch(e){console.error("删除失败:",e),y.error("删除失败，请稍后再试")}}).catch(()=>{})},J=o=>({admin:"管理员",teacher:"教师",student:"学生"})[o]||"未知",K=o=>({admin:"danger",teacher:"warning",student:"success"})[o]||"info";return ee(()=>{f()}),(o,e)=>{const c=s("el-icon"),g=s("el-button"),b=s("el-input"),d=s("el-form-item"),v=s("el-option"),M=s("el-select"),P=s("el-switch"),$=s("el-form"),Q=s("el-dialog"),m=s("el-table-column"),B=s("el-tag"),W=s("el-table"),X=s("el-pagination"),Y=s("el-card"),G=te("loading");return k(),le("div",me,[l(Y,null,{header:a(()=>[x("div",ce,[e[14]||(e[14]=x("span",null,"用户管理",-1)),l(g,{type:"primary",onClick:j},{default:a(()=>[l(c,null,{default:a(()=>[l(re(se))]),_:1}),e[13]||(e[13]=i(" 添加用户 ",-1))]),_:1})])]),default:a(()=>[l(Q,{modelValue:_.value,"onUpdate:modelValue":e[8]||(e[8]=t=>_.value=t),title:n.value?"编辑用户":"添加用户",width:"500px",onClose:O},{footer:a(()=>[x("span",ge,[l(g,{onClick:e[7]||(e[7]=t=>_.value=!1)},{default:a(()=>[...e[15]||(e[15]=[i("取消",-1)])]),_:1}),l(g,{type:"primary",onClick:I},{default:a(()=>[...e[16]||(e[16]=[i("确定",-1)])]),_:1})])]),default:a(()=>[l($,{model:r,rules:q,ref_key:"userFormRef",ref:w,"label-width":"100px"},{default:a(()=>[l(d,{label:"用户名",prop:"username"},{default:a(()=>[l(b,{modelValue:r.username,"onUpdate:modelValue":e[0]||(e[0]=t=>r.username=t),disabled:n.value},null,8,["modelValue","disabled"])]),_:1}),n.value?D("",!0):(k(),h(d,{key:0,label:"密码",prop:"password"},{default:a(()=>[l(b,{modelValue:r.password,"onUpdate:modelValue":e[1]||(e[1]=t=>r.password=t),type:"password","show-password":""},null,8,["modelValue"])]),_:1})),l(d,{label:"姓名",prop:"realName"},{default:a(()=>[l(b,{modelValue:r.realName,"onUpdate:modelValue":e[2]||(e[2]=t=>r.realName=t)},null,8,["modelValue"])]),_:1}),l(d,{label:"角色",prop:"role"},{default:a(()=>[l(M,{modelValue:r.role,"onUpdate:modelValue":e[3]||(e[3]=t=>r.role=t),placeholder:"请选择角色",disabled:n.value},{default:a(()=>[l(v,{label:"学生",value:"student"}),l(v,{label:"教师",value:"teacher"}),l(v,{label:"管理员",value:"admin"})]),_:1},8,["modelValue","disabled"])]),_:1}),l(d,{label:"邮箱",prop:"email"},{default:a(()=>[l(b,{modelValue:r.email,"onUpdate:modelValue":e[4]||(e[4]=t=>r.email=t)},null,8,["modelValue"])]),_:1}),l(d,{label:"手机号",prop:"phone"},{default:a(()=>[l(b,{modelValue:r.phone,"onUpdate:modelValue":e[5]||(e[5]=t=>r.phone=t)},null,8,["modelValue"])]),_:1}),n.value?(k(),h(d,{key:1,label:"状态",prop:"status"},{default:a(()=>[l(P,{modelValue:r.status,"onUpdate:modelValue":e[6]||(e[6]=t=>r.status=t),"active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})):D("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l($,{inline:!0,model:p,class:"search-form"},{default:a(()=>[l(d,{label:"角色"},{default:a(()=>[l(M,{modelValue:p.role,"onUpdate:modelValue":e[9]||(e[9]=t=>p.role=t),placeholder:"请选择角色",clearable:""},{default:a(()=>[l(v,{label:"学生",value:"student"}),l(v,{label:"教师",value:"teacher"}),l(v,{label:"管理员",value:"admin"})]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"关键词"},{default:a(()=>[l(b,{modelValue:p.keyword,"onUpdate:modelValue":e[10]||(e[10]=t=>p.keyword=t),placeholder:"用户名/姓名",clearable:""},null,8,["modelValue"])]),_:1}),l(d,null,{default:a(()=>[l(g,{type:"primary",onClick:F},{default:a(()=>[...e[17]||(e[17]=[i("查询",-1)])]),_:1}),l(g,{onClick:N},{default:a(()=>[...e[18]||(e[18]=[i("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),oe((k(),h(W,{data:z.value,border:"",stripe:""},{empty:a(()=>[l(pe,{description:"暂无用户"},{default:a(()=>[l(g,{type:"primary",onClick:N},{default:a(()=>[...e[19]||(e[19]=[i("清空筛选",-1)])]),_:1})]),_:1})]),default:a(()=>[l(m,{prop:"id",label:"ID",width:"80"}),l(m,{prop:"username",label:"用户名",width:"120"}),l(m,{prop:"realName",label:"姓名",width:"100"}),l(m,{prop:"role",label:"角色",width:"100"},{default:a(({row:t})=>[l(B,{type:K(t.role)},{default:a(()=>[i(E(J(t.role)),1)]),_:2},1032,["type"])]),_:1}),l(m,{prop:"email",label:"邮箱"}),l(m,{prop:"phone",label:"手机号",width:"120"}),l(m,{prop:"status",label:"状态",width:"80"},{default:a(({row:t})=>[l(B,{type:t.status===1?"success":"danger"},{default:a(()=>[i(E(t.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(m,{prop:"createTime",label:"创建时间",width:"180"}),l(m,{label:"操作",width:"180",fixed:"right"},{default:a(({row:t})=>[l(g,{type:"primary",size:"small",onClick:H=>A(t)},{default:a(()=>[...e[20]||(e[20]=[i(" 编辑 ",-1)])]),_:1},8,["onClick"]),l(g,{type:"danger",size:"small",onClick:H=>L(t)},{default:a(()=>[...e[21]||(e[21]=[i(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[G,C.value]]),l(X,{"current-page":u.current,"onUpdate:currentPage":e[11]||(e[11]=t=>u.current=t),"page-size":u.size,"onUpdate:pageSize":e[12]||(e[12]=t=>u.size=t),total:u.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:R,onCurrentChange:T,class:"pagination"},null,8,["current-page","page-size","total"])]),_:1})])}}},ye=Z(fe,[["__scopeId","data-v-8157ecc8"]]);export{ye as default};
