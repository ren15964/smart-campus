import{a as B}from"./grade-DO4JpUgO.js";import{_ as M,s as R,c as k,b as I,a as l,w as t,h as S,g as C,r as s,o as V,G as O,H as $,I as q,f as b,E as f}from"./index-CWfbs8s0.js";const F={class:"teacher-grade-manage"},P={class:"dialog-footer"},z={__name:"TeacherGradeManage",setup(H){const d=C({courseId:null}),_=S([]),c=S([]),m=S(!1),r=C({id:null,studentName:"",usualScore:0,finalScore:0,totalScore:0}),x=()=>new Promise(o=>{setTimeout(()=>{o([{id:1,name:"数据结构"},{id:2,name:"算法设计"}])},500)}),G=o=>new Promise((e,i)=>{setTimeout(()=>{console.log("模拟修改成绩请求",o),Math.random()>.3?e({code:200,msg:"成绩修改成功，等待审批！"}):i({code:500,msg:"成绩修改失败，操作受限或网络异常。"})},800)}),v=async()=>{if(d.courseId){const o=await B(d.courseId);c.value=o.data||[{id:1,studentName:"张三",usualScore:85,finalScore:90,totalScore:88,studentId:101,courseId:1},{id:2,studentName:"李四",usualScore:70,finalScore:75,totalScore:72.5,studentId:102,courseId:1}]}else c.value=[]},N=()=>{if(c.value.length===0){f.warning("没有成绩数据可以导出！");return}const o=["学生姓名","平时分","期末分","总分"],e=c.value.map(n=>[n.studentName,n.usualScore,n.finalScore,n.totalScore]);let i=o.join(",")+`
`;e.forEach(n=>{i+=n.join(",")+`
`});const g=new Blob([i],{type:"text/csv;charset=utf-8;"}),u=document.createElement("a");u.href=URL.createObjectURL(g),u.download=`grades_${d.courseId||"all"}.csv`,u.click(),URL.revokeObjectURL(u.href),f.success("成绩导出成功！")},U=o=>{Object.assign(r,o),m.value=!0},L=async()=>{console.log("提交修改成绩:",r);try{const o=await G(r);o.code===200?(f.success(o.msg),v()):f.error(o.msg||"成绩修改失败")}catch(o){f.error(o.msg||"网络错误或服务器异常")}m.value=!1};return R(async()=>{_.value=await x(),_.value.length>0&&(d.courseId=_.value[0].id,v())}),(o,e)=>{const i=s("el-option"),g=s("el-select"),u=s("el-form-item"),n=s("el-button"),w=s("el-form"),p=s("el-table-column"),E=s("el-table"),T=s("el-card"),h=s("el-input"),y=s("el-input-number"),j=s("el-dialog");return V(),k("div",F,[e[10]||(e[10]=I("h2",null,"教师成绩管理",-1)),l(T,null,{default:t(()=>[l(w,{inline:!0,model:d,class:"query-form"},{default:t(()=>[l(u,{label:"选择课程"},{default:t(()=>[l(g,{modelValue:d.courseId,"onUpdate:modelValue":e[0]||(e[0]=a=>d.courseId=a),placeholder:"请选择课程",onChange:v},{default:t(()=>[(V(!0),k(O,null,$(_.value,a=>(V(),q(i,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,null,{default:t(()=>[l(n,{type:"success",onClick:N,disabled:!c.value.length},{default:t(()=>[...e[6]||(e[6]=[b("导出成绩",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"]),l(E,{data:c.value,border:"",style:{width:"100%"}},{default:t(()=>[l(p,{prop:"studentName",label:"学生姓名"}),l(p,{prop:"usualScore",label:"平时分"}),l(p,{prop:"finalScore",label:"期末分"}),l(p,{prop:"totalScore",label:"总分"}),l(p,{label:"操作",width:"120"},{default:t(a=>[l(n,{link:"",type:"primary",size:"small",onClick:A=>U(a.row)},{default:t(()=>[...e[7]||(e[7]=[b("修改",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),l(j,{modelValue:m.value,"onUpdate:modelValue":e[5]||(e[5]=a=>m.value=a),title:"修改成绩",width:"500"},{footer:t(()=>[I("div",P,[l(n,{onClick:e[4]||(e[4]=a=>m.value=!1)},{default:t(()=>[...e[8]||(e[8]=[b("取消",-1)])]),_:1}),l(n,{type:"primary",onClick:L},{default:t(()=>[...e[9]||(e[9]=[b(" 提交修改 ",-1)])]),_:1})])]),default:t(()=>[l(w,{model:r,"label-width":"100px"},{default:t(()=>[l(u,{label:"学生姓名"},{default:t(()=>[l(h,{modelValue:r.studentName,"onUpdate:modelValue":e[1]||(e[1]=a=>r.studentName=a),disabled:""},null,8,["modelValue"])]),_:1}),l(u,{label:"平时分"},{default:t(()=>[l(y,{modelValue:r.usualScore,"onUpdate:modelValue":e[2]||(e[2]=a=>r.usualScore=a),min:0,max:100},null,8,["modelValue"])]),_:1}),l(u,{label:"期末分"},{default:t(()=>[l(y,{modelValue:r.finalScore,"onUpdate:modelValue":e[3]||(e[3]=a=>r.finalScore=a),min:0,max:100},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},K=M(z,[["__scopeId","data-v-63908b8e"]]);export{K as default};
