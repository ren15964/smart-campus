import{b as q,g as I,s as j}from"./course-selection-CMAZX65Q.js";import{_ as G,p as J,s as L,c as m,a as t,w as a,E as _,r,h as S,g as M,S as O,o as u,U as Y,I as z,f as n,t as g,J as v,a3 as A,a4 as K,a5 as Q,G as W,H as X,a6 as Z,b as C,a7 as $}from"./index-CWfbs8s0.js";const ee={class:"selection-manage-container"},te={class:"statistics-display"},ae={key:0},le={key:1},se={__name:"SelectionManage",setup(oe){const b=S("period"),c=S(!1),k=S(null),o=M({startTime:null,endTime:null}),P={startTime:[{required:!0,message:"请选择选课开始时间",trigger:"change"}],endTime:[{required:!0,message:"请选择选课结束时间",trigger:"change"}]},T=async()=>{c.value=!0;try{const l=await q();l.code===200&&l.data&&(o.startTime=l.data.startTime,o.endTime=l.data.endTime)}catch(l){console.error("获取选课时间失败:",l),_.error("获取选课时间失败，请稍后再试")}finally{c.value=!1}},h=()=>{var l;(l=k.value)==null||l.validate(async e=>{if(e){if(new Date(o.startTime).getTime()>=new Date(o.endTime).getTime()){_.error("结束时间必须晚于开始时间");return}try{const d=await j(o);d.code===200?_.success("选课时间设置成功"):_.error(d.message||"选课时间设置失败")}catch(d){console.error("保存选课时间失败:",d),_.error("保存选课时间失败，请稍后再试")}}})},F=()=>{T()},H=(l,e)=>{if(!e)return!1;const d=new Date(e);return l.getTime()<d.getTime()},i=M({totalCourses:0,totalStudents:0,averageCoursesPerStudent:0,hotCourses:[]}),V=async()=>{c.value=!0;try{const l=await I();l.code===200&&l.data&&Object.assign(i,l.data)}catch(l){console.error("获取选课统计失败:",l),_.error("获取选课统计失败，请稍后再试")}finally{c.value=!1}};return J(b,l=>{l==="period"?T():l==="statistics"&&V()}),L(()=>{T(),V()}),(l,e)=>{const d=r("el-date-picker"),y=r("el-form-item"),D=r("el-button"),B=r("el-form"),w=r("el-tab-pane"),f=r("el-icon"),p=r("el-descriptions-item"),E=r("el-descriptions"),N=r("el-tabs"),R=r("el-card"),x=O("loading");return u(),m("div",ee,[t(R,{class:"box-card"},{header:a(()=>[...e[3]||(e[3]=[C("div",{class:"card-header"},[C("span",null,"选课管理")],-1)])]),default:a(()=>[t(N,{modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=s=>b.value=s),class:"custom-tabs"},{default:a(()=>[t(w,{label:"选课时间设置",name:"period"},{default:a(()=>[Y((u(),z(B,{model:o,rules:P,ref_key:"periodFormRef",ref:k,"label-width":"120px",class:"period-form"},{default:a(()=>[t(y,{label:"选课开始时间",prop:"startTime"},{default:a(()=>[t(d,{modelValue:o.startTime,"onUpdate:modelValue":e[0]||(e[0]=s=>o.startTime=s),type:"datetime",placeholder:"选择开始日期时间","value-format":"YYYY-MM-DD HH:mm:ss",clearable:""},null,8,["modelValue"])]),_:1}),t(y,{label:"选课结束时间",prop:"endTime"},{default:a(()=>[t(d,{modelValue:o.endTime,"onUpdate:modelValue":e[1]||(e[1]=s=>o.endTime=s),type:"datetime",placeholder:"选择结束日期时间","value-format":"YYYY-MM-DD HH:mm:ss",clearable:"","disabled-date":s=>H(s,o.startTime)},null,8,["modelValue","disabled-date"])]),_:1}),t(y,null,{default:a(()=>[t(D,{type:"primary",onClick:h},{default:a(()=>[...e[4]||(e[4]=[n("保存设置",-1)])]),_:1}),t(D,{onClick:F},{default:a(()=>[...e[5]||(e[5]=[n("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])),[[x,c.value]])]),_:1}),t(w,{label:"选课统计",name:"statistics"},{default:a(()=>[Y((u(),m("div",te,[t(E,{class:"margin-top",title:"选课总体统计",column:3,border:""},{default:a(()=>[t(p,null,{label:a(()=>[t(f,null,{default:a(()=>[t(v(A))]),_:1}),e[6]||(e[6]=n(" 总课程数 ",-1))]),default:a(()=>[n(" "+g(i.totalCourses),1)]),_:1}),t(p,null,{label:a(()=>[t(f,null,{default:a(()=>[t(v(K))]),_:1}),e[7]||(e[7]=n(" 总学生数 ",-1))]),default:a(()=>[n(" "+g(i.totalStudents),1)]),_:1}),t(p,null,{label:a(()=>[t(f,null,{default:a(()=>[t(v(Q))]),_:1}),e[8]||(e[8]=n(" 平均选课门数 ",-1))]),default:a(()=>{var s;return[n(" "+g(((s=i.averageCoursesPerStudent)==null?void 0:s.toFixed(2))||0),1)]}),_:1}),t(p,null,{label:a(()=>[t(f,null,{default:a(()=>[t(v(Z))]),_:1}),e[9]||(e[9]=n(" 热门课程（前3） ",-1))]),default:a(()=>[i.hotCourses&&i.hotCourses.length>0?(u(),m("div",ae,[(u(!0),m(W,null,X(i.hotCourses,(s,U)=>(u(),m("p",{key:U},g(s.courseName)+" ("+g(s.selectedCount)+"人) ",1))),128))])):(u(),m("span",le,"暂无数据"))]),_:1}),t(p,null,{label:a(()=>[t(f,null,{default:a(()=>[t(v($))]),_:1}),e[10]||(e[10]=n(" 选课趋势 ",-1))]),default:a(()=>[e[11]||(e[11]=C("span",null,"（待图表实现）",-1))]),_:1})]),_:1})])),[[x,c.value]])]),_:1})]),_:1},8,["modelValue"])]),_:1})])}}},de=G(se,[["__scopeId","data-v-4638a5dd"]]);export{de as default};
