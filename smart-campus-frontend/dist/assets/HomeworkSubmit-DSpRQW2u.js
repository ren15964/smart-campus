import{_ as W,s as X,c as f,a as n,w as s,i as Z,E as u,r as d,h as v,g as G,d as K,o as m,b as l,t as c,J as B,Z as H,f as r,j as g,I as M,Q as Y}from"./index-CWfbs8s0.js";import{a as $,s as ee}from"./homework-CyJgRgDB.js";import{A as te}from"./AppEmpty-B1CMOFz1.js";const oe={class:"homework-submit-container"},ne={class:"card-header"},le={key:0,class:"detail-content"},se={class:"homework-title"},ae={class:"homework-meta"},re=["innerHTML"],ie={key:0,class:"homework-attachment"},ue={key:1,class:"submission-info"},de=["innerHTML"],me={key:0,class:"submission-attachment"},ce={key:1,class:"grade-info"},fe={key:2,class:"submission-form"},pe={__name:"HomeworkSubmit",setup(_e){const F=Z(),w=K(),b=F.params.id,o=v({id:null,title:"",content:"",attachment:"",deadline:"",totalScore:0,courseName:"",teacherName:"",submitInfo:null}),h=v(!1),k=v(!1),I=v(null),i=G({homeworkId:b,content:"",file:null}),p=v([]),N={content:[{required:!1,message:"请输入提交内容或上传附件",trigger:"blur",validator:(t,e,a)=>{!e&&p.value.length===0?a(new Error(t.message)):a()}}]},x=async()=>{if(!b){u.error("缺少作业ID");return}h.value=!0;try{const t=await $(b);t.code===200?(Object.assign(o.value,t.data),i.homeworkId=b):u.error(t.message||"获取作业详情失败")}catch(t){console.error("获取作业详情失败:",t),u.error("获取作业详情失败，请稍后再试")}finally{h.value=!1}},C=t=>{switch(t){case 0:return"未提交";case 1:return"已提交";case 2:return"已批改";default:return"未知"}},D=t=>{switch(t){case 0:return"danger";case 1:return"warning";case 2:return"success";default:return"info"}},E=(t,e,a)=>{t.code===200?(i.file=t.data.filePath,u.success("文件上传成功")):(p.value=[],u.error(t.message||"文件上传失败"))},V=(t,e,a)=>{u.error("文件上传失败，请重试"),console.error("文件上传失败:",t)},R=(t,e)=>{i.file=null},j=t=>{const e=t.size/1024/1024<10;return e||u.error("上传附件大小不能超过 10MB!"),e},U=()=>{var t;(t=I.value)==null||t.validate(async e=>{if(e){if(!i.content&&!i.file){u.warning("请输入提交内容或上传附件");return}k.value=!0;try{const a=new FormData;a.append("homeworkId",i.homeworkId),a.append("content",i.content),p.value.length>0&&p.value[0].raw?a.append("file",p.value[0].raw):i.file&&a.append("attachment",i.file);const _=await ee(a);_.code===200?(u.success("作业提交成功"),x()):u.error(_.message||"作业提交失败")}catch(a){console.error("作业提交失败:",a),u.error("作业提交失败，请稍后再试")}finally{k.value=!1}}})},z=()=>{Y.confirm("确定要取消提交吗？已填写的内容将不会保存。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{w.back()}).catch(()=>{u.info("已取消")})},A=()=>{w.back()};return X(()=>{x()}),(t,e)=>{const a=d("el-button"),_=d("el-divider"),S=d("el-icon"),T=d("el-link"),L=d("el-tag"),P=d("el-input"),y=d("el-form-item"),q=d("el-upload"),J=d("el-form"),O=d("el-card");return m(),f("div",oe,[n(O,{class:"box-card"},{header:s(()=>[l("div",ne,[e[2]||(e[2]=l("span",null,"作业详情与提交",-1)),n(a,{type:"primary",link:"",onClick:A},{default:s(()=>[...e[1]||(e[1]=[r("返回",-1)])]),_:1})])]),default:s(()=>[o.value.id?(m(),f("div",le,[l("h2",se,c(o.value.title),1),l("div",ae,[l("span",null,"课程: "+c(o.value.courseName),1),l("span",null,"教师: "+c(o.value.teacherName),1),l("span",null,"截止日期: "+c(o.value.deadline),1),l("span",null,"总分: "+c(o.value.totalScore),1)]),n(_),l("div",{class:"homework-body",innerHTML:o.value.content},null,8,re),o.value.attachment?(m(),f("div",ie,[n(T,{href:o.value.attachment,target:"_blank",type:"primary"},{default:s(()=>[n(S,null,{default:s(()=>[n(B(H))]),_:1}),e[3]||(e[3]=r(" 附件下载 ",-1))]),_:1},8,["href"])])):g("",!0),n(_,{"content-position":"left"},{default:s(()=>[...e[4]||(e[4]=[r("我的提交",-1)])]),_:1}),o.value.submitInfo&&o.value.submitInfo.submitId?(m(),f("div",ue,[l("p",null,[e[6]||(e[6]=l("strong",null,"提交状态:",-1)),n(L,{type:D(o.value.submitInfo.status)},{default:s(()=>[r(c(C(o.value.submitInfo.status)),1)]),_:1},8,["type"]),o.value.submitInfo.isLate?(m(),M(L,{key:0,type:"danger",style:{"margin-left":"10px"}},{default:s(()=>[...e[5]||(e[5]=[r("迟交",-1)])]),_:1})):g("",!0)]),l("p",null,[e[7]||(e[7]=l("strong",null,"提交时间:",-1)),r(" "+c(o.value.submitInfo.submitTime),1)]),e[12]||(e[12]=l("p",null,[l("strong",null,"提交内容:")],-1)),l("div",{class:"submission-content",innerHTML:o.value.submitInfo.content},null,8,de),o.value.submitInfo.attachment?(m(),f("div",me,[n(T,{href:o.value.submitInfo.attachment,target:"_blank",type:"primary"},{default:s(()=>[n(S,null,{default:s(()=>[n(B(H))]),_:1}),e[8]||(e[8]=r(" 已提交附件下载 ",-1))]),_:1},8,["href"])])):g("",!0),o.value.submitInfo.status===2?(m(),f("div",ce,[n(_,{"content-position":"left"},{default:s(()=>[...e[9]||(e[9]=[r("批改信息",-1)])]),_:1}),l("p",null,[e[10]||(e[10]=l("strong",null,"分数:",-1)),r(" "+c(o.value.submitInfo.score),1)]),l("p",null,[e[11]||(e[11]=l("strong",null,"评语:",-1)),r(" "+c(o.value.submitInfo.comment||"无"),1)])])):g("",!0)])):(m(),f("div",fe,[n(J,{model:i,rules:N,ref_key:"submitFormRef",ref:I,"label-width":"80px"},{default:s(()=>[n(y,{label:"提交内容",prop:"content"},{default:s(()=>[n(P,{modelValue:i.content,"onUpdate:modelValue":e[0]||(e[0]=Q=>i.content=Q),type:"textarea",rows:"5",placeholder:"请输入作业内容"},null,8,["modelValue"])]),_:1}),n(y,{label:"上传附件",prop:"file"},{default:s(()=>[n(q,{class:"upload-demo",action:"/api/file/upload","on-success":E,"on-error":V,"on-remove":R,"before-upload":j,limit:1,"file-list":p.value,accept:".doc,.docx,.pdf,.zip,.rar,.txt,.ppt,.pptx,.xls,.xlsx,.jpg,.jpeg,.png"},{tip:s(()=>[...e[14]||(e[14]=[l("div",{class:"el-upload__tip"},"可上传 Word, PDF, 压缩包, TXT, 图片等文件，大小不超过10MB",-1)])]),default:s(()=>[n(a,{type:"primary"},{default:s(()=>[...e[13]||(e[13]=[r("点击上传",-1)])]),_:1})]),_:1},8,["file-list"])]),_:1}),n(y,null,{default:s(()=>[n(a,{type:"primary",onClick:U,loading:k.value},{default:s(()=>[...e[15]||(e[15]=[r(" 提交作业 ",-1)])]),_:1},8,["loading"]),n(a,{onClick:z},{default:s(()=>[...e[16]||(e[16]=[r("取消",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]))])):(m(),M(te,{key:1,description:"作业不存在或已删除"}))]),_:1})])}}},ke=W(pe,[["__scopeId","data-v-85cc208e"]]);export{ke as default};
