import{_ as P,p as j,c as T,a as t,w as a,r as c,i as O,d as $,S as F,o as g,f as u,U as M,I as q,b,g as k,k as G,E as p,h as v}from"./index-jCaZfwQD.js";import{d as H,g as J}from"./resource-DrvMw_ac.js";import{A as K}from"./AppEmpty-BAEE0X2a.js";const Q={class:"resource-list-container"},W={class:"card-header"},X={class:"pagination-container"},Y={__name:"ResourceList",setup(Z){const h=O(),C=$(),m=v([]),f=v(!1),s=k({chapter:"",keyword:""}),r=k({current:1,size:10,total:0}),z=G(()=>{const o=(r.current-1)*r.size,e=o+r.size;return m.value.slice(o,e)}),_=async()=>{const o=h.params.scheduleId;if(!o||isNaN(Number(o))){p.error("缺少或无效的开课计划ID，无法获取资源");return}f.value=!0;try{const e=await J({scheduleId:o,...s});e.code===200&&(m.value=Array.isArray(e.data)?e.data:[],r.total=m.value.length)}catch(e){console.error("获取资源列表失败:",e),p.error("获取资源列表失败，请稍后再试")}finally{f.value=!1}},R=()=>{r.current=1,_()},y=()=>{s.chapter="",s.keyword="",r.current=1,_()},U=o=>{r.size=o},V=o=>{r.current=o},I=o=>{o.filePath?window.open(o.filePath,"_blank"):p.warning("文件路径不存在，无法预览")},L=async o=>{try{const e=await H(o.id),n=window.URL.createObjectURL(e),i=document.createElement("a");i.href=n,i.setAttribute("download",o.resourceName),document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(n),p.success("下载成功")}catch(e){console.error("下载失败:",e),p.error("下载失败，请稍后再试")}},N=()=>{C.back()};return j(()=>h.params.scheduleId,(o,e)=>{o!==e&&(r.current=1,_())},{immediate:!0}),(o,e)=>{const n=c("el-button"),i=c("el-input"),w=c("el-form-item"),x=c("el-form"),d=c("el-table-column"),S=c("el-table"),A=c("el-pagination"),B=c("el-card"),D=F("loading");return g(),T("div",Q,[t(B,{class:"box-card"},{header:a(()=>[b("div",W,[e[5]||(e[5]=b("span",null,"课程资源列表",-1)),t(n,{type:"primary",link:"",onClick:N},{default:a(()=>[...e[4]||(e[4]=[u("返回",-1)])]),_:1})])]),default:a(()=>[t(x,{inline:!0,model:s,class:"search-form"},{default:a(()=>[t(w,{label:"章节"},{default:a(()=>[t(i,{modelValue:s.chapter,"onUpdate:modelValue":e[0]||(e[0]=l=>s.chapter=l),placeholder:"请输入章节",clearable:""},null,8,["modelValue"])]),_:1}),t(w,{label:"资源名称"},{default:a(()=>[t(i,{modelValue:s.keyword,"onUpdate:modelValue":e[1]||(e[1]=l=>s.keyword=l),placeholder:"请输入资源名称",clearable:""},null,8,["modelValue"])]),_:1}),t(w,null,{default:a(()=>[t(n,{type:"primary",onClick:R},{default:a(()=>[...e[6]||(e[6]=[u("查询",-1)])]),_:1}),t(n,{onClick:y},{default:a(()=>[...e[7]||(e[7]=[u("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),M((g(),q(S,{data:z.value,border:"",style:{width:"100%"}},{empty:a(()=>[t(K,{description:"暂无资源"},{default:a(()=>[t(n,{type:"primary",onClick:y},{default:a(()=>[...e[8]||(e[8]=[u("清空筛选",-1)])]),_:1})]),_:1})]),default:a(()=>[t(d,{prop:"id",label:"ID",width:"80"}),t(d,{prop:"resourceName",label:"资源名称","show-overflow-tooltip":""}),t(d,{prop:"resourceType",label:"类型",width:"100"}),t(d,{prop:"chapter",label:"章节",width:"120"}),t(d,{prop:"description",label:"描述","show-overflow-tooltip":""}),t(d,{prop:"downloadCount",label:"下载量",width:"100"}),t(d,{prop:"createTime",label:"上传时间",width:"180"}),t(d,{label:"操作",width:"150"},{default:a(l=>[t(n,{type:"primary",link:"",onClick:E=>I(l.row)},{default:a(()=>[...e[9]||(e[9]=[u(" 预览 ",-1)])]),_:1},8,["onClick"]),t(n,{type:"success",link:"",onClick:E=>L(l.row)},{default:a(()=>[...e[10]||(e[10]=[u(" 下载 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[D,f.value]]),b("div",X,[t(A,{"current-page":r.current,"onUpdate:currentPage":e[2]||(e[2]=l=>r.current=l),"page-size":r.size,"onUpdate:pageSize":e[3]||(e[3]=l=>r.size=l),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:r.total,onSizeChange:U,onCurrentChange:V},null,8,["current-page","page-size","total"])])]),_:1})])}}},ae=P(Y,[["__scopeId","data-v-6a3131b6"]]);export{ae as default};
