import{_ as Q,s as W,c as k,a as o,w as s,$ as X,i as Y,E as p,r,h as m,d as ee,S as te,o as c,U as oe,I as y,f as u,t as v,j as h,b as d,J as se,Z as le,z as ae,g as ne}from"./index-CWfbs8s0.js";import{a as re,b as ue,c as ie}from"./homework-CyJgRgDB.js";const de={class:"homework-grade-container"},me={class:"card-header"},ce={key:0,class:"submission-detail-content"},fe=["innerHTML"],_e={key:0,class:"submission-attachment"},pe={key:2,class:"graded-info"},ve={class:"dialog-footer"},be={__name:"HomeworkGrade",setup(ge){const T=Y(),H=ee(),w=T.params.id,S=m("加载中..."),V=m(100),x=m([]),b=m(!1),f=m(!1),n=m({}),g=m(null),a=ne({submitId:null,score:null,comment:""}),R={score:[{required:!0,message:"请输入分数",trigger:"change"}]},C=async()=>{if(!w){p.error("缺少作业ID");return}b.value=!0;try{const t=await re(w);if(t.code===200)S.value=t.data.title,V.value=t.data.totalScore;else{p.error(t.message||"获取作业详情失败"),b.value=!1;return}const e=await ue(w);e.code===200&&(x.value=e.data)}catch(t){console.error("获取作业提交列表失败:",t),p.error("获取作业提交列表失败，请稍后再试")}finally{b.value=!1}},D=t=>{switch(t){case 0:return"未提交";case 1:return"已提交";case 2:return"已批改";default:return"未知"}},B=t=>{switch(t){case 0:return"warning";case 1:return"warning";case 2:return"success";default:return"info"}},F=()=>{H.back()},$=t=>{n.value={...t},f.value=!0,t.status===2?(a.score=t.score,a.comment=t.comment):(a.score=null,a.comment="")},G=t=>{n.value={...t},f.value=!0,ae(()=>{var e;(e=g.value)==null||e.resetFields(),a.submitId=t.submitId,t.status===2&&(a.score=t.score,a.comment=t.comment)})},L=()=>{var t;(t=g.value)==null||t.validate(async e=>{if(e)try{const i=await ie(a);i.code===200?(p.success("批改成功"),f.value=!1,C()):p.error(i.message||"批改失败")}catch(i){console.error("批改失败:",i),p.error("批改失败，请稍后再试")}})},M=()=>{var t;(t=g.value)==null||t.resetFields(),Object.assign(a,{submitId:null,score:null,comment:""}),n.value={}};return W(()=>{C()}),(t,e)=>{const i=r("el-button"),_=r("el-table-column"),N=r("el-tag"),U=r("el-table"),E=r("el-card"),j=r("el-icon"),q=r("el-link"),z=r("el-divider"),A=r("el-input-number"),I=r("el-form-item"),J=r("el-input"),O=r("el-form"),Z=r("el-dialog"),K=te("loading");return c(),k("div",de,[o(E,{class:"box-card"},{header:s(()=>[d("div",me,[d("span",null,"作业批改 - "+v(S.value),1),o(i,{type:"primary",link:"",onClick:F},{default:s(()=>[...e[4]||(e[4]=[u("返回",-1)])]),_:1})])]),default:s(()=>[oe((c(),y(U,{data:x.value,border:"",style:{width:"100%"}},{default:s(()=>[o(_,{prop:"studentNo",label:"学号",width:"120"}),o(_,{prop:"studentName",label:"姓名",width:"120"}),o(_,{prop:"submitTime",label:"提交时间",width:"180"}),o(_,{label:"状态",width:"100"},{default:s(l=>[o(N,{type:B(l.row.status)},{default:s(()=>[u(v(D(l.row.status)),1)]),_:2},1032,["type"]),l.row.isLate?(c(),y(N,{key:0,type:"danger",style:{"margin-left":"5px"}},{default:s(()=>[...e[5]||(e[5]=[u("迟交",-1)])]),_:1})):h("",!0)]),_:1}),o(_,{prop:"score",label:"分数",width:"80"},{default:s(l=>[u(v(l.row.score===null?"-":l.row.score),1)]),_:1}),o(_,{label:"操作",width:"150"},{default:s(l=>[o(i,{type:"primary",link:"",onNclick:P=>$(l.row)},{default:s(()=>[...e[6]||(e[6]=[u(" 查看 ",-1)])]),_:1},8,["onNclick"]),o(i,{type:"success",link:"",disabled:l.row.status===2,onClick:P=>G(l.row)},{default:s(()=>[u(v(l.row.status===2?"已批改":"批改"),1)]),_:2},1032,["disabled","onClick"])]),_:1})]),_:1},8,["data"])),[[K,b.value]])]),_:1}),o(Z,{modelValue:f.value,"onUpdate:modelValue":e[3]||(e[3]=l=>f.value=l),title:n.value.studentName?`${n.value.studentName} 的提交`:"提交详情",width:"800px",onClose:M},X({default:s(()=>[n.value.submitId?(c(),k("div",ce,[e[11]||(e[11]=d("p",null,[d("strong",null,"提交内容:")],-1)),d("div",{class:"submission-content",innerHTML:n.value.content},null,8,fe),n.value.attachment?(c(),k("div",_e,[o(q,{href:n.value.attachment,target:"_blank",type:"primary"},{default:s(()=>[o(j,null,{default:s(()=>[o(se(le))]),_:1}),e[7]||(e[7]=u(" 附件下载 ",-1))]),_:1},8,["href"])])):h("",!0),o(z,{"content-position":"left"},{default:s(()=>[...e[8]||(e[8]=[u("批改",-1)])]),_:1}),n.value.status!==2?(c(),y(O,{key:1,model:a,rules:R,ref_key:"gradeFormRef",ref:g,"label-width":"80px"},{default:s(()=>[o(I,{label:"分数",prop:"score"},{default:s(()=>[o(A,{modelValue:a.score,"onUpdate:modelValue":e[0]||(e[0]=l=>a.score=l),min:0,max:V.value},null,8,["modelValue","max"])]),_:1}),o(I,{label:"评语",prop:"comment"},{default:s(()=>[o(J,{modelValue:a.comment,"onUpdate:modelValue":e[1]||(e[1]=l=>a.comment=l),type:"textarea",rows:"3"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])):(c(),k("div",pe,[d("p",null,[e[9]||(e[9]=d("strong",null,"分数:",-1)),u(" "+v(n.value.score),1)]),d("p",null,[e[10]||(e[10]=d("strong",null,"评语:",-1)),u(" "+v(n.value.comment||"无"),1)])]))])):h("",!0)]),_:2},[n.value.status!==2?{name:"footer",fn:s(()=>[d("span",ve,[o(i,{onClick:e[2]||(e[2]=l=>f.value=!1)},{default:s(()=>[...e[12]||(e[12]=[u("取消",-1)])]),_:1}),o(i,{type:"primary",onClick:L},{default:s(()=>[...e[13]||(e[13]=[u("确定",-1)])]),_:1})])]),key:"0"}:void 0]),1032,["modelValue","title"])])}}},ye=Q(be,[["__scopeId","data-v-45e297ff"]]);export{ye as default};
