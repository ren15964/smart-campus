import{g as oe,a as ae,u as te,b as re}from"./resource-D2o3D_e2.js";import{a as se}from"./course-C49Ad3WT.js";import{A as ne}from"./AppEmpty-B1CMOFz1.js";import{_ as ue,s as ie,c as P,a as o,w as a,E as u,r as d,h as _,g as R,S as de,o as y,f,U as ce,I as k,b as V,t as pe,G as me,H as fe,j as E,z as I,Q as ve}from"./index-CWfbs8s0.js";const ge={class:"resource-manage-container"},he={class:"card-header"},_e={class:"pagination-container"},be={class:"dialog-footer"},ye={__name:"ResourceManage",setup(we){const T=_([]),z=_(!1),v=R({chapter:"",keyword:""}),i=R({current:1,size:10,total:0}),b=_(!1),c=_(!1),C=_(null),N=_([]),r=R({id:null,scheduleId:null,resourceName:"",resourceType:"document",chapter:"",description:"",filePath:""}),p=_([]),$={scheduleId:[{required:!0,message:"请选择所属课程",trigger:"change"}],resourceName:[{required:!0,message:"请输入资源名称",trigger:"blur"}],resourceType:[{required:!0,message:"请选择资源类型",trigger:"change"}],file:[{required:!1,message:"请上传文件",trigger:"change",validator:(l,e,s)=>{!c.value&&!r.filePath&&p.value.length===0?s(new Error(l.message)):s()}}]},h=async()=>{z.value=!0;try{const l=await oe({current:i.current,size:i.size,...v});l.code===200&&(T.value=l.data.records,i.total=l.data.total)}catch(l){console.error("获取资源列表失败:",l),u.error("获取资源失败，请稍后再试")}finally{z.value=!1}},B=async()=>{if(!(N.value.length>0))try{const l=await se({current:1,size:1e3});l.code===200&&(N.value=l.data.records)}catch(l){console.error("获取教师课程选项失败:",l)}},D=()=>{i.current=1,h()},U=()=>{v.chapter="",v.keyword="",i.current=1,h()},L=l=>{i.size=l,h()},M=l=>{i.current=l,h()},S=()=>{c.value=!1,b.value=!0,I(()=>{var l;(l=C.value)==null||l.resetFields(),Object.assign(r,{id:null,scheduleId:null,resourceName:"",resourceType:"document",chapter:"",description:"",filePath:""}),p.value=[]})},j=l=>{c.value=!0,b.value=!0,I(()=>{Object.assign(r,l),p.value=l.filePath?[{name:l.resourceName,url:l.filePath}]:[]})},O=async l=>{ve.confirm(`确定要删除资源《${l.resourceName}》吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const e=await ae(l.id);e.code===200?(u.success("删除成功"),h()):u.error(e.message||"删除失败")}catch(e){console.error("删除失败:",e),u.error("删除失败，请稍后再试")}}).catch(()=>{u.info("已取消删除")})},q=()=>{var l;(l=C.value)==null||l.validate(async e=>{if(e)try{let s;const m=new FormData;if(Object.keys(r).forEach(n=>{n!=="id"&&r[n]!==null&&m.append(n,r[n])}),c.value)s=await te(r.id,r);else{if(p.value.length>0&&p.value[0].raw)m.append("file",p.value[0].raw);else if(!r.filePath){u.error("请上传文件或提供文件路径");return}s=await re(m)}s.code===200?(u.success(`${c.value?"编辑":"上传"}成功`),b.value=!1,h()):u.error(s.message||`${c.value?"编辑":"上传"}失败`)}catch(s){console.error(`${c.value?"编辑":"上传"}失败:`,s),u.error(`${c.value?"编辑":"上传"}失败，请稍后再试`)}})},A=()=>{var l;(l=C.value)==null||l.resetFields(),Object.assign(r,{id:null,scheduleId:null,resourceName:"",resourceType:"document",chapter:"",description:"",filePath:""}),p.value=[]},G=(l,e,s)=>{l.code===200?(r.filePath=l.data.filePath,u.success("文件上传成功")):(p.value=[],u.error(l.message||"文件上传失败"))},H=(l,e,s)=>{u.error("文件上传失败，请重试"),console.error("文件上传失败:",l)},Q=(l,e)=>{r.filePath=null},J=l=>{const e=l.size/1024/1024<50;return e||u.error("上传附件大小不能超过 50MB!"),e};return ie(()=>{h()}),(l,e)=>{const s=d("el-button"),m=d("el-input"),n=d("el-form-item"),x=d("el-form"),g=d("el-table-column"),K=d("el-table"),W=d("el-pagination"),X=d("el-card"),w=d("el-option"),F=d("el-select"),Y=d("el-upload"),Z=d("el-dialog"),ee=de("loading");return y(),P("div",ge,[o(X,{class:"box-card"},{header:a(()=>[V("div",he,[V("span",null,"课程资源管理 - "+pe(l.courseName),1),o(s,{type:"primary",onClick:S},{default:a(()=>[...e[11]||(e[11]=[f("上传资源",-1)])]),_:1})])]),default:a(()=>[o(x,{inline:!0,model:v,class:"search-form"},{default:a(()=>[o(n,{label:"章节"},{default:a(()=>[o(m,{modelValue:v.chapter,"onUpdate:modelValue":e[0]||(e[0]=t=>v.chapter=t),placeholder:"请输入章节",clearable:""},null,8,["modelValue"])]),_:1}),o(n,{label:"资源名称"},{default:a(()=>[o(m,{modelValue:v.keyword,"onUpdate:modelValue":e[1]||(e[1]=t=>v.keyword=t),placeholder:"请输入资源名称",clearable:""},null,8,["modelValue"])]),_:1}),o(n,null,{default:a(()=>[o(s,{type:"primary",onClick:D},{default:a(()=>[...e[12]||(e[12]=[f("查询",-1)])]),_:1}),o(s,{onClick:U},{default:a(()=>[...e[13]||(e[13]=[f("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),ce((y(),k(K,{data:T.value,border:"",style:{width:"100%"}},{empty:a(()=>[o(ne,{description:"暂无资源"},{default:a(()=>[o(s,{type:"primary",onClick:U},{default:a(()=>[...e[14]||(e[14]=[f("清空筛选",-1)])]),_:1})]),_:1})]),default:a(()=>[o(g,{prop:"id",label:"ID",width:"80"}),o(g,{prop:"resourceName",label:"资源名称","show-overflow-tooltip":""}),o(g,{prop:"resourceType",label:"类型",width:"100"}),o(g,{prop:"chapter",label:"章节",width:"120"}),o(g,{prop:"description",label:"描述","show-overflow-tooltip":""}),o(g,{prop:"downloadCount",label:"下载量",width:"100"}),o(g,{prop:"createTime",label:"上传时间",width:"180"}),o(g,{label:"操作",width:"180"},{default:a(t=>[o(s,{type:"primary",link:"",onClick:le=>j(t.row)},{default:a(()=>[...e[15]||(e[15]=[f(" 编辑 ",-1)])]),_:1},8,["onClick"]),o(s,{type:"danger",link:"",onClick:le=>O(t.row)},{default:a(()=>[...e[16]||(e[16]=[f(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ee,z.value]]),V("div",_e,[o(W,{"current-page":i.current,"onUpdate:currentPage":e[2]||(e[2]=t=>i.current=t),"page-size":i.size,"onUpdate:pageSize":e[3]||(e[3]=t=>i.size=t),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:i.total,onSizeChange:L,onCurrentChange:M},null,8,["current-page","page-size","total"])])]),_:1}),o(Z,{modelValue:b.value,"onUpdate:modelValue":e[10]||(e[10]=t=>b.value=t),title:c.value?"编辑资源":"上传资源",width:"600px",onClose:A},{footer:a(()=>[V("span",be,[o(s,{onClick:e[9]||(e[9]=t=>b.value=!1)},{default:a(()=>[...e[19]||(e[19]=[f("取消",-1)])]),_:1}),o(s,{type:"primary",onClick:q},{default:a(()=>[...e[20]||(e[20]=[f("确定",-1)])]),_:1})])]),default:a(()=>[o(x,{model:r,rules:$,ref_key:"resourceFormRef",ref:C,"label-width":"100px"},{default:a(()=>[c.value?E("",!0):(y(),k(n,{key:0,label:"所属课程",prop:"scheduleId"},{default:a(()=>[o(F,{modelValue:r.scheduleId,"onUpdate:modelValue":e[4]||(e[4]=t=>r.scheduleId=t),placeholder:"请选择课程",filterable:"",onFocus:B},{default:a(()=>[(y(!0),P(me,null,fe(N.value,t=>(y(),k(w,{key:t.id,label:`${t.courseName} (${t.semester})`,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})),o(n,{label:"资源名称",prop:"resourceName"},{default:a(()=>[o(m,{modelValue:r.resourceName,"onUpdate:modelValue":e[5]||(e[5]=t=>r.resourceName=t)},null,8,["modelValue"])]),_:1}),o(n,{label:"资源类型",prop:"resourceType"},{default:a(()=>[o(F,{modelValue:r.resourceType,"onUpdate:modelValue":e[6]||(e[6]=t=>r.resourceType=t),placeholder:"请选择资源类型"},{default:a(()=>[o(w,{label:"文档",value:"document"}),o(w,{label:"视频",value:"video"}),o(w,{label:"图片",value:"image"}),o(w,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),o(n,{label:"章节",prop:"chapter"},{default:a(()=>[o(m,{modelValue:r.chapter,"onUpdate:modelValue":e[7]||(e[7]=t=>r.chapter=t)},null,8,["modelValue"])]),_:1}),o(n,{label:"描述",prop:"description"},{default:a(()=>[o(m,{modelValue:r.description,"onUpdate:modelValue":e[8]||(e[8]=t=>r.description=t),type:"textarea",rows:"3"},null,8,["modelValue"])]),_:1}),c.value?E("",!0):(y(),k(n,{key:1,label:"文件上传",prop:"file"},{default:a(()=>[o(Y,{class:"upload-demo",action:"/api/file/upload","on-success":G,"on-error":H,"on-remove":Q,"before-upload":J,limit:1,"file-list":p.value},{tip:a(()=>[...e[18]||(e[18]=[V("div",{class:"el-upload__tip"},"可上传各类文件，大小不超过50MB",-1)])]),default:a(()=>[o(s,{type:"primary"},{default:a(()=>[...e[17]||(e[17]=[f("点击上传",-1)])]),_:1})]),_:1},8,["file-list"])]),_:1}))]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Ne=ue(ye,[["__scopeId","data-v-ea18c285"]]);export{Ne as default};
