import{_ as j,s as A,c as T,a as t,w as l,i as M,E as _,r as c,h as g,g as k,d as O,S as $,o as v,f as u,U as F,I as q,b as w}from"./index-CWfbs8s0.js";import{g as G,d as H}from"./resource-D2o3D_e2.js";import{A as J}from"./AppEmpty-B1CMOFz1.js";const K={class:"resource-list-container"},Q={class:"card-header"},W={class:"pagination-container"},X={__name:"ResourceList",setup(Y){const C=M(),z=O(),b=C.params.scheduleId,h=g([]),f=g(!1),s=k({chapter:"",keyword:""}),r=k({current:1,size:10,total:0}),p=async()=>{if(!b){_.error("缺少开课计划ID，无法获取资源");return}f.value=!0;try{const o=await G({scheduleId:b,current:r.current,size:r.size,...s});o.code===200&&(h.value=o.data.records,r.total=o.data.total)}catch(o){console.error("获取资源列表失败:",o),_.error("获取资源列表失败，请稍后再试")}finally{f.value=!1}},R=()=>{r.current=1,p()},y=()=>{s.chapter="",s.keyword="",r.current=1,p()},U=o=>{r.size=o,p()},V=o=>{r.current=o,p()},L=o=>{o.filePath?window.open(o.filePath,"_blank"):_.warning("文件路径不存在，无法预览")},x=async o=>{try{const e=await H(o.id),d=new Blob([e],{type:e.headers["content-type"]}),m=window.URL.createObjectURL(d),n=document.createElement("a");n.href=m,n.setAttribute("download",o.resourceName),document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(m),_.success("下载成功")}catch(e){console.error("下载失败:",e),_.error("下载失败，请稍后再试")}},I=()=>{z.back()};return A(()=>{p()}),(o,e)=>{const d=c("el-button"),m=c("el-input"),n=c("el-form-item"),B=c("el-form"),i=c("el-table-column"),D=c("el-table"),E=c("el-pagination"),N=c("el-card"),S=$("loading");return v(),T("div",K,[t(N,{class:"box-card"},{header:l(()=>[w("div",Q,[e[5]||(e[5]=w("span",null,"课程资源列表",-1)),t(d,{type:"primary",link:"",onClick:I},{default:l(()=>[...e[4]||(e[4]=[u("返回",-1)])]),_:1})])]),default:l(()=>[t(B,{inline:!0,model:s,class:"search-form"},{default:l(()=>[t(n,{label:"章节"},{default:l(()=>[t(m,{modelValue:s.chapter,"onUpdate:modelValue":e[0]||(e[0]=a=>s.chapter=a),placeholder:"请输入章节",clearable:""},null,8,["modelValue"])]),_:1}),t(n,{label:"资源名称"},{default:l(()=>[t(m,{modelValue:s.keyword,"onUpdate:modelValue":e[1]||(e[1]=a=>s.keyword=a),placeholder:"请输入资源名称",clearable:""},null,8,["modelValue"])]),_:1}),t(n,null,{default:l(()=>[t(d,{type:"primary",onClick:R},{default:l(()=>[...e[6]||(e[6]=[u("查询",-1)])]),_:1}),t(d,{onClick:y},{default:l(()=>[...e[7]||(e[7]=[u("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),F((v(),q(D,{data:h.value,border:"",style:{width:"100%"}},{empty:l(()=>[t(J,{description:"暂无资源"},{default:l(()=>[t(d,{type:"primary",onClick:y},{default:l(()=>[...e[8]||(e[8]=[u("清空筛选",-1)])]),_:1})]),_:1})]),default:l(()=>[t(i,{prop:"id",label:"ID",width:"80"}),t(i,{prop:"resourceName",label:"资源名称","show-overflow-tooltip":""}),t(i,{prop:"resourceType",label:"类型",width:"100"}),t(i,{prop:"chapter",label:"章节",width:"120"}),t(i,{prop:"description",label:"描述","show-overflow-tooltip":""}),t(i,{prop:"downloadCount",label:"下载量",width:"100"}),t(i,{prop:"createTime",label:"上传时间",width:"180"}),t(i,{label:"操作",width:"150"},{default:l(a=>[t(d,{type:"primary",link:"",onClick:P=>L(a.row)},{default:l(()=>[...e[9]||(e[9]=[u(" 预览 ",-1)])]),_:1},8,["onClick"]),t(d,{type:"success",link:"",onClick:P=>x(a.row)},{default:l(()=>[...e[10]||(e[10]=[u(" 下载 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[S,f.value]]),w("div",W,[t(E,{"current-page":r.current,"onUpdate:currentPage":e[2]||(e[2]=a=>r.current=a),"page-size":r.size,"onUpdate:pageSize":e[3]||(e[3]=a=>r.size=a),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:r.total,onSizeChange:U,onCurrentChange:V},null,8,["current-page","page-size","total"])])]),_:1})])}}},oe=j(X,[["__scopeId","data-v-06d52784"]]);export{oe as default};
