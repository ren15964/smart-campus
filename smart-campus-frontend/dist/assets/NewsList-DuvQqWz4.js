import{_ as P,a8 as p,s as R,c as m,a as r,w as n,r as c,h as i,d as F,o as l,b as o,G as N,H as L,I as y,e as G,f as M,t as C,j as B,k as Q}from"./index-jCaZfwQD.js";import{A as J}from"./AppEmpty-BAEE0X2a.js";const O={class:"news-list-container"},W={class:"filter-section"},X={class:"news-items"},Y={class:"news-item-content"},Z={class:"news-meta"},ee={class:"category-tag"},te={class:"publish-date"},ae={class:"hot-news-list"},se=["onClick"],oe={__name:"NewsList",setup(ne){p.defaults.baseURL="http://localhost:8080/api",p.interceptors.request.use(e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization=`Bearer ${t}`),e},e=>Promise.reject(e));const S=e=>{const t=_.value.find(s=>s.id===e);return t?t.name:""},D=F(),v=i([]),_=i([]),g=i([]),h=i(null),f=i(""),w=i(1),k=i(10),u=i(0),d=async()=>{try{const e={current:w.value,size:k.value};h.value&&(e.category=S(h.value));const t=await p.get("/news/list",{params:e});t.data.code===200&&t.data.data?(v.value=t.data.data.records,u.value=t.data.data.total):(v.value=[],u.value=0)}catch(e){console.error("获取新闻列表失败:",e),v.value=[],u.value=0}},A=async()=>{try{const e=await p.get("/news/list",{params:{current:1,size:999}});if(e.data.code===200&&e.data.data&&e.data.data.records){const t=new Set;e.data.data.records.forEach(s=>{s.category&&t.add(s.category)}),_.value=Array.from(t).map((s,b)=>({id:b+1,name:s}))}}catch(e){console.error("获取新闻分类失败:",e),_.value=[]}},I=async()=>{try{const e=await p.get("/news/list",{params:{current:1,size:10}});e.data.code===200&&e.data.data&&e.data.data.records?g.value=e.data.data.records.sort((t,s)=>s.viewCount&&t.viewCount?s.viewCount-t.viewCount:new Date(s.publishTime).getTime()-new Date(t.publishTime).getTime()).slice(0,5):g.value=[]}catch(e){console.error("获取热门新闻失败:",e),g.value=[]}},V=Q(()=>{let e=v.value;if(f.value){const t=f.value.toLowerCase();e=e.filter(s=>s.title.toLowerCase().includes(t))}return e}),j=e=>{k.value=e,w.value=1},q=e=>{w.value=e},x=e=>{D.push({name:"NewsDetail",params:{id:e}})};return R(()=>{A(),d(),I()}),(e,t)=>{const s=c("el-option"),b=c("el-select"),E=c("el-input"),U=c("el-button"),z=c("el-card"),$=c("el-pagination"),T=c("el-col"),H=c("el-row");return l(),m("div",O,[r(z,{class:"box-card"},{header:n(()=>[...t[2]||(t[2]=[o("div",{class:"card-header"},[o("span",null,"校园新闻")],-1)])]),default:n(()=>[o("div",W,[r(b,{modelValue:h.value,"onUpdate:modelValue":t[0]||(t[0]=a=>h.value=a),placeholder:"选择分类",clearable:"",onChange:d},{default:n(()=>[(l(!0),m(N,null,L(_.value,a=>(l(),y(s,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),r(E,{modelValue:f.value,"onUpdate:modelValue":t[1]||(t[1]=a=>f.value=a),placeholder:"搜索新闻标题",clearable:"",onClear:d,onKeyup:G(d,["enter"])},null,8,["modelValue"]),r(U,{type:"primary",onClick:d},{default:n(()=>[...t[3]||(t[3]=[M("搜索",-1)])]),_:1})]),r(H,{gutter:20},{default:n(()=>[r(T,{span:18},{default:n(()=>[o("div",X,[(l(!0),m(N,null,L(V.value,a=>(l(),y(z,{key:a.id,class:"news-item-card",shadow:"hover",onClick:K=>x(a.id)},{default:n(()=>[o("div",Y,[o("h3",null,C(a.title),1),o("div",Z,[o("span",ee,C(a.category),1),o("span",te,C(a.publishTime),1)]),t[4]||(t[4]=o("p",{class:"news-summary"},"点击查看详情...",-1))])]),_:2},1032,["onClick"]))),128)),V.value.length===0?(l(),y(J,{key:0,description:"暂无新闻"})):B("",!0)]),u.value>0?(l(),y($,{key:0,onSizeChange:j,onCurrentChange:q,"current-page":w.value,"page-sizes":[5,10,15,20],"page-size":k.value,layout:"total, sizes, prev, pager, next, jumper",total:u.value},null,8,["current-page","page-size","total"])):B("",!0)]),_:1}),r(T,{span:6},{default:n(()=>[r(z,{class:"hot-news-card"},{header:n(()=>[...t[5]||(t[5]=[o("div",{class:"card-header"},[o("span",null,"热门新闻")],-1)])]),default:n(()=>[o("ul",ae,[(l(!0),m(N,null,L(g.value,a=>(l(),m("li",{key:a.id,onClick:K=>x(a.id)},C(a.title),9,se))),128))])]),_:1})]),_:1})]),_:1})]),_:1})])}}},ce=P(oe,[["__scopeId","data-v-f9ed3c3a"]]);export{ce as default};
