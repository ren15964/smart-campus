import{b as j,g as B}from"./grade-DO4JpUgO.js";import{A as L}from"./AppEmpty-B1CMOFz1.js";import{_ as R,s as D,c as M,a as t,w as o,E as m,r as n,h as C,g,S as O,o as S,f as _,U as A,I,b as a,t as f}from"./index-CWfbs8s0.js";const Q={class:"grade-query-container"},q={class:"statistics-content"},F={class:"stat-item"},T={class:"stat-value"},$={class:"stat-item"},z={class:"stat-value"},H={class:"stat-item"},J={class:"stat-value"},K={class:"stat-item"},P={class:"stat-value"},W={__name:"GradeQuery",setup(X){const p=C([]),b=C(!1),d=g({semester:""}),u=g({totalCredits:0,averageGpa:0,passedCourses:0,failedCourses:0}),v=async()=>{b.value=!0;try{const l=await j(d);l.code===200&&(p.value=l.data)}catch(l){console.error("获取个人成绩失败:",l),m.error("获取个人成绩失败，请稍后再试")}finally{b.value=!1}},x=async()=>{try{const l=await B();l.code===200&&Object.assign(u,l.data)}catch(l){console.error("获取成绩统计失败:",l),m.error("获取成绩统计失败，请稍后再试")}},k=()=>{v()},y=()=>{d.semester="",v()},G=()=>{if(p.value.length===0){m.warning("没有成绩数据可以导出！");return}const l=["学期","课程编码","课程名称","任课教师","学分","平时成绩","期末成绩","总成绩","绩点"],e=p.value.map(s=>[s.semester,s.courseCode,s.courseName,s.teacherName,s.credit,s.usualScore,s.examScore,s.totalScore,s.gpa]);let i=l.join(",")+`
`;e.forEach(s=>{i+=s.join(",")+`
`});const h=new Blob([i],{type:"text/csv;charset=utf-8;"}),c=document.createElement("a");c.href=URL.createObjectURL(h),c.download=`student_grades_${d.semester||"all"}.csv`,c.click(),URL.revokeObjectURL(c.href),m.success("成绩导出成功！")};return D(()=>{v(),x()}),(l,e)=>{const i=n("el-option"),h=n("el-select"),c=n("el-form-item"),s=n("el-button"),N=n("el-form"),r=n("el-table-column"),E=n("el-table"),w=n("el-card"),U=O("loading");return S(),M("div",Q,[t(w,{class:"box-card"},{header:o(()=>[...e[1]||(e[1]=[a("div",{class:"card-header"},[a("span",null,"成绩查询")],-1)])]),default:o(()=>[t(N,{inline:!0,model:d,class:"search-form"},{default:o(()=>[t(c,{label:"学期"},{default:o(()=>[t(h,{modelValue:d.semester,"onUpdate:modelValue":e[0]||(e[0]=V=>d.semester=V),placeholder:"请选择学期",clearable:""},{default:o(()=>[t(i,{label:"2023-2024-1",value:"2023-2024-1"}),t(i,{label:"2023-2024-2",value:"2023-2024-2"}),t(i,{label:"2024-2025-1",value:"2024-2025-1"})]),_:1},8,["modelValue"])]),_:1}),t(c,null,{default:o(()=>[t(s,{type:"primary",onClick:k},{default:o(()=>[...e[2]||(e[2]=[_("查询",-1)])]),_:1}),t(s,{onClick:y},{default:o(()=>[...e[3]||(e[3]=[_("重置",-1)])]),_:1}),t(s,{type:"success",onClick:G,disabled:!p.value.length},{default:o(()=>[...e[4]||(e[4]=[_("导出成绩",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"]),A((S(),I(E,{data:p.value,border:"",style:{width:"100%","margin-bottom":"20px"}},{empty:o(()=>[t(L,{description:"暂无成绩数据"},{default:o(()=>[t(s,{type:"primary",onClick:y},{default:o(()=>[...e[5]||(e[5]=[_("清空筛选",-1)])]),_:1})]),_:1})]),default:o(()=>[t(r,{prop:"semester",label:"学期",width:"120"}),t(r,{prop:"courseCode",label:"课程编码",width:"120"}),t(r,{prop:"courseName",label:"课程名称"}),t(r,{prop:"teacherName",label:"任课教师",width:"120"}),t(r,{prop:"credit",label:"学分",width:"80"}),t(r,{prop:"usualScore",label:"平时成绩",width:"100"}),t(r,{prop:"examScore",label:"期末成绩",width:"100"}),t(r,{prop:"totalScore",label:"总成绩",width:"100"}),t(r,{prop:"gpa",label:"绩点",width:"80"})]),_:1},8,["data"])),[[U,b.value]]),t(w,{class:"statistics-card"},{header:o(()=>[...e[6]||(e[6]=[a("span",null,"成绩统计",-1)])]),default:o(()=>[a("div",q,[a("div",F,[e[7]||(e[7]=a("span",null,"总学分:",-1)),a("span",T,f(u.totalCredits),1)]),a("div",$,[e[8]||(e[8]=a("span",null,"平均绩点:",-1)),a("span",z,f(u.averageGpa),1)]),a("div",H,[e[9]||(e[9]=a("span",null,"通过课程数:",-1)),a("span",J,f(u.passedCourses),1)]),a("div",K,[e[10]||(e[10]=a("span",null,"未通过课程数:",-1)),a("span",P,f(u.failedCourses),1)])])]),_:1})]),_:1})])}}},te=R(W,[["__scopeId","data-v-9fb13b7e"]]);export{te as default};
