import{g as H,d as J,u as K,p as W}from"./notice-CcvhTZXk.js";import{A as X}from"./AppEmpty-B1CMOFz1.js";import{_ as Y,s as Z,c as ee,a as t,w as l,E as f,r as s,h as v,g as h,S as te,o as U,f as d,U as le,I as ae,t as oe,b as w,z as re,Q as ne}from"./index-CWfbs8s0.js";const ie={class:"notice-manage-container"},se={class:"card-header"},ue={class:"pagination-container"},de={class:"dialog-footer"},pe={__name:"NoticeManage",setup(ce){const x=v([]),V=v(!1),p=h({keyword:"",priority:null}),i=h({current:1,size:10,total:0}),_=v(!1),c=v(!1),k=v(null),r=h({id:null,title:"",content:"",priority:1,targetRole:"all",attachment:""}),R={title:[{required:!0,message:"请输入通知标题",trigger:"blur"}],content:[{required:!0,message:"请输入通知内容",trigger:"blur"}],priority:[{required:!0,message:"请选择优先级",trigger:"change"}],targetRole:[{required:!0,message:"请选择发布范围",trigger:"change"}]},g=async()=>{V.value=!0;try{const o=await H({current:i.current,size:i.size,...p});o.code===200&&(x.value=o.data.records,i.total=o.data.total)}catch(o){console.error("获取通知列表失败:",o),f.error("获取通知失败，请稍后再试")}finally{V.value=!1}},$=()=>{i.current=1,g()},z=()=>{p.keyword="",p.priority=null,i.current=1,g()},B=o=>{i.size=o,g()},E=o=>{i.current=o,g()},S=o=>{switch(o){case 1:return"普通";case 2:return"重要";case 3:return"紧急";default:return"未知"}},T=o=>{switch(o){case 1:return"info";case 2:return"warning";case 3:return"danger";default:return"info"}},D=()=>{c.value=!1,_.value=!0},F=o=>{c.value=!0,_.value=!0,re(()=>{Object.assign(r,o)})},M=async o=>{ne.confirm(`确定要删除通知《${o.title}》吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const e=await J(o.id);e.code===200?(f.success("删除成功"),g()):f.error(e.message||"删除失败")}catch(e){console.error("删除失败:",e),f.error("删除失败，请稍后再试")}}).catch(()=>{f.info("已取消删除")})},q=()=>{var o;(o=k.value)==null||o.validate(async e=>{if(e)try{let n;c.value?n=await K(r.id,r):n=await W(r),n.code===200?(f.success(`${c.value?"编辑":"发布"}成功`),_.value=!1,g()):f.error(n.message||`${c.value?"编辑":"发布"}失败`)}catch(n){console.error(`${c.value?"编辑":"发布"}失败:`,n),f.error(`${c.value?"编辑":"发布"}失败，请稍后再试`)}})},j=()=>{var o;(o=k.value)==null||o.resetFields(),Object.assign(r,{id:null,title:"",content:"",priority:1,targetRole:"all",attachment:""})};return Z(()=>{g()}),(o,e)=>{const n=s("el-button"),b=s("el-input"),m=s("el-form-item"),u=s("el-option"),C=s("el-select"),N=s("el-form"),y=s("el-table-column"),A=s("el-tag"),I=s("el-table"),L=s("el-pagination"),P=s("el-card"),O=s("el-dialog"),Q=te("loading");return U(),ee("div",ie,[t(P,{class:"box-card"},{header:l(()=>[w("div",se,[e[12]||(e[12]=w("span",null,"通知管理",-1)),t(n,{type:"primary",onClick:D},{default:l(()=>[...e[11]||(e[11]=[d("发布通知",-1)])]),_:1})])]),default:l(()=>[t(N,{inline:!0,model:p,class:"search-form"},{default:l(()=>[t(m,{label:"标题"},{default:l(()=>[t(b,{modelValue:p.keyword,"onUpdate:modelValue":e[0]||(e[0]=a=>p.keyword=a),placeholder:"请输入标题",clearable:""},null,8,["modelValue"])]),_:1}),t(m,{label:"优先级"},{default:l(()=>[t(C,{modelValue:p.priority,"onUpdate:modelValue":e[1]||(e[1]=a=>p.priority=a),placeholder:"请选择优先级",clearable:""},{default:l(()=>[t(u,{label:"普通",value:1}),t(u,{label:"重要",value:2}),t(u,{label:"紧急",value:3})]),_:1},8,["modelValue"])]),_:1}),t(m,null,{default:l(()=>[t(n,{type:"primary",onClick:$},{default:l(()=>[...e[13]||(e[13]=[d("查询",-1)])]),_:1}),t(n,{onClick:z},{default:l(()=>[...e[14]||(e[14]=[d("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),le((U(),ae(I,{data:x.value,border:"",style:{width:"100%"}},{empty:l(()=>[t(X,{description:"暂无通知"},{default:l(()=>[t(n,{type:"primary",onClick:z},{default:l(()=>[...e[15]||(e[15]=[d("清空筛选",-1)])]),_:1})]),_:1})]),default:l(()=>[t(y,{prop:"id",label:"ID",width:"80"}),t(y,{prop:"title",label:"标题","show-overflow-tooltip":""}),t(y,{prop:"publisherName",label:"发布人",width:"120"}),t(y,{label:"优先级",width:"100"},{default:l(a=>[t(A,{type:T(a.row.priority)},{default:l(()=>[d(oe(S(a.row.priority)),1)]),_:2},1032,["type"])]),_:1}),t(y,{prop:"publishTime",label:"发布时间",width:"180"}),t(y,{label:"操作",width:"180"},{default:l(a=>[t(n,{type:"primary",link:"",onClick:G=>F(a.row)},{default:l(()=>[...e[16]||(e[16]=[d(" 编辑 ",-1)])]),_:1},8,["onClick"]),t(n,{type:"danger",link:"",onClick:G=>M(a.row)},{default:l(()=>[...e[17]||(e[17]=[d(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Q,V.value]]),w("div",ue,[t(L,{"current-page":i.current,"onUpdate:currentPage":e[2]||(e[2]=a=>i.current=a),"page-size":i.size,"onUpdate:pageSize":e[3]||(e[3]=a=>i.size=a),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:i.total,onSizeChange:B,onCurrentChange:E},null,8,["current-page","page-size","total"])])]),_:1}),t(O,{modelValue:_.value,"onUpdate:modelValue":e[10]||(e[10]=a=>_.value=a),title:c.value?"编辑通知":"发布通知",width:"700px",onClose:j},{footer:l(()=>[w("span",de,[t(n,{onClick:e[9]||(e[9]=a=>_.value=!1)},{default:l(()=>[...e[18]||(e[18]=[d("取消",-1)])]),_:1}),t(n,{type:"primary",onClick:q},{default:l(()=>[...e[19]||(e[19]=[d("确定",-1)])]),_:1})])]),default:l(()=>[t(N,{model:r,rules:R,ref_key:"noticeFormRef",ref:k,"label-width":"100px"},{default:l(()=>[t(m,{label:"标题",prop:"title"},{default:l(()=>[t(b,{modelValue:r.title,"onUpdate:modelValue":e[4]||(e[4]=a=>r.title=a)},null,8,["modelValue"])]),_:1}),t(m,{label:"内容",prop:"content"},{default:l(()=>[t(b,{modelValue:r.content,"onUpdate:modelValue":e[5]||(e[5]=a=>r.content=a),type:"textarea",rows:"5"},null,8,["modelValue"])]),_:1}),t(m,{label:"优先级",prop:"priority"},{default:l(()=>[t(C,{modelValue:r.priority,"onUpdate:modelValue":e[6]||(e[6]=a=>r.priority=a),placeholder:"请选择优先级"},{default:l(()=>[t(u,{label:"普通",value:1}),t(u,{label:"重要",value:2}),t(u,{label:"紧急",value:3})]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"发布范围",prop:"targetRole"},{default:l(()=>[t(C,{modelValue:r.targetRole,"onUpdate:modelValue":e[7]||(e[7]=a=>r.targetRole=a),placeholder:"请选择发布范围"},{default:l(()=>[t(u,{label:"所有用户",value:"all"}),t(u,{label:"学生",value:"student"}),t(u,{label:"教师",value:"teacher"}),t(u,{label:"管理员",value:"admin"})]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"附件",prop:"attachment"},{default:l(()=>[t(b,{modelValue:r.attachment,"onUpdate:modelValue":e[8]||(e[8]=a=>r.attachment=a),placeholder:"请输入附件URL（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},_e=Y(pe,[["__scopeId","data-v-1f759645"]]);export{_e as default};
